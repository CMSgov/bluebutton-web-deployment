---
# - name: pause for ssh testing
#   pause:
#     seconds: 120
- name: uninstall ansible and ansible-core
  become_user: "{{ remote_admin_account }}"
  become: yes
  command: "python3 -m pip uninstall ansible ansible-core -y"
- name: install ansible 2.9 for galaxy collections
  become_user: "{{ remote_admin_account }}"
  become: yes
  command: "pip3 install ansible==2.9"
- name: install amazon aws ansible galaxy collection for secrets plugin
  become_user: "{{ remote_admin_account }}"
  become: yes
  command: "ansible-galaxy collection install amazon.aws:4.5.0"
- name: Apply security patches
  become_user: "{{ remote_admin_account }}"
  become: yes
  command: "yum update-minimal --security -y"
- name: Install extras python3.8
  become_user: "{{ remote_admin_account }}"
  become: yes
  command: "amazon-linux-extras install python3.8 -y"
- name: Install dependencies
  become: yes
  become_user: "{{ remote_admin_account }}"
  yum:
    name:
      - gcc
      - git
      - python38-devel
      - postgresql-devel
      - zlib-devel
      - libjpeg-turbo-devel
      - nginx
      - amazon-cloudwatch-agent
- name: Install uwsgi ansible boto3 and botocore psycopg2-binary==2.9.6 via pip3.8
  become: yes
  become_user: "{{ remote_admin_account }}"
  pip:
    name: 
      - uwsgi
      - ansible
      - boto3
      - botocore
      - psycopg2-binary
    executable: pip3.8
    umask: "0022"