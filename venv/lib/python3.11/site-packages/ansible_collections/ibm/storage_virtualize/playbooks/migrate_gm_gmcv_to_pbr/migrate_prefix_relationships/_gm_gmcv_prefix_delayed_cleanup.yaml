- name: Get single relationship detailed info
  register: rel_info
  ibm.storage_virtualize.ibm_svc_info:
    clustername: "{{ master_clustername }}"
    token: "{{ master_auth.token }}"
    gather_subset: rcrelationship
    objectname: "{{ item }}"
    log_path: "{{ logpath }}"
- name: Delete specified relationships
  when: rel_info.RemoteCopy != None
  block:
    - name: Stop relationship
      ibm.storage_virtualize.ibm_svc_start_stop_replication:
        clustername: "{{ master_clustername }}"
        token: "{{ master_auth.token }}"
        name: "{{ item }}"
        state: stopped
        log_path: "{{ logpath }}"
    - name: Delete relationship
      ibm.storage_virtualize.ibm_svc_manage_replication:
        clustername: "{{ master_clustername }}"
        token: "{{ master_auth.token }}"
        name: "{{ item }}"
        state: absent
        log_path: "{{ logpath }}"
    - name: Delete aux volume
      ibm.storage_virtualize.ibm_svc_manage_volume:
        clustername: "{{ aux_clustername }}"
        token: "{{ aux_auth.token }}"
        name: "{{ rel_info.RemoteCopy.aux_vdisk_name }}"
        state: absent
        log_path: "{{ logpath }}"
